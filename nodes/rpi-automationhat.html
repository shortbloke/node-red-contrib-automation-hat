<!--
  Copyright 2016 Pimoroni Ltd

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/javascript">
    RED.nodes.registerType("rpi-automation-hat in",{
        category: "Raspberry Pi",
        paletteLabel: "Automation HAT",
        color: '#c6dbef',
        defaults: {
            name: { value: "" },
            input: { value: true },
            analog: { value: true }
        },
        inputs:0,
        outputs:1,
        icon:  "rpi.png",
        label: function() {
            return this.name||"Automation HAT";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });
    RED.nodes.registerType("rpi-automation-hat out",{
        category: "Raspberry Pi",
        paletteLabel: "Automation HAT",
        color: '#c6dbef',
        defaults: {
            name: { value: "" },
        },
        inputs:1,
        outputs:0,
        icon:  "rpi.png",
        label: function() {
            return this.name||"Automation HAT";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });

</script>

<script type="text/x-red" data-template-name="rpi-automation-hat in">
<div class="form-row">
    <label><i class="fa fa-arrow-right"></i> Outputs</label>
    <label style="width: auto" for="node-input-input"><input style="vertical-align: top; width: auto; margin-right: 5px;" type="checkbox" id="node-input-input"> Input events</label>
    <div style="padding-left: 125px; margin-top: -5px; color: #bbb;">5v tolerant inputs 1, 2, and 3</div>
</div>
<div class="form-row">
    <label></label>
    <label style="width: auto" for="node-input-analog"><input style="vertical-align: top; width: auto; margin-right: 5px;" type="checkbox" id="node-input-analog"> Analog events</label>
    <div style="padding-left: 125px; margin-top: -5px; color: #bbb;">5v tolerant analog inputs 1, 2, 3 and 4</div>
</div>

<div class="form-row">
    <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
    <input type="text" id="node-input-name">
</div>
</script>

<script type="text/x-red" data-help-name="rpi-automation-hat in">
<p>Raspberry Pi Automation HAT input node.</p>
<p>This node sends readings from the various inputs on Automation HAT, grouped into two sets; input events and analog events.</p>

<p><b>Input Events</b></p>
<p>Input events are generated by the three 5v tolerant protected inputs on Automation HAT. A message will be sent every time an input changes. The <code>topic</code> is set to <code>automationhat/input.&lt;channel&gt;</code> and the <code>payload</code> is an number that's either:</p>
<ul>
    <li><code>1</code> : indicating the input is HIGH.</li>
    <li><code>0</code> : indicating the input is LOW.</li>
</ul>

<p><b>Analog Events</b></p>
<p>Analog events are generated by the four 5v tolerant analog inputs on Automation HAT and three inputs on the Automation pHAT. A message will be sent when the analog value changes by 10mV or more, giving 500 steps of granularity. The <code>topic</code> is set to <code>automationhat/analog.&lt;channel&gt;</code> and the <code>payload</code> is a number ranging from 0 (0v) to 5 (5v):</p>

<p>For example, a topic of <code>automationhat/analog.2</code> and a payload of <code>3.33</code> would indicate that 3.33v is present on Analog 2.</p>

</script>

<script type="text/x-red" data-template-name="rpi-automation-hat out">
<div class="form-row">
    <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
    <input type="text" id="node-input-name">
</div>
</script>

<script type="text/x-red" data-help-name="rpi-automation-hat out">
<p>Raspberry Pi Automation HAT output node.</p>
<p>This node controls the various outputs on Automation HAT, grouped into three sets; digital outputs, relays and lights.</p>

<p><b>Digital Outputs</b></p>
<p>The three outputs on Automation HAT are 24V tolerant, sinking outputs. That means you should connect them between your load and ground. They act like a switch down to ground, toggling your load on and off. The outputs are driven by a ULN2003A Darlington Array driver.</p>
<p>Digital outputs are controlled by sending a message with the topic <code>output.&lt;channel&gt;</code> where channel is a number from 1 to 3 (corresponding to the numbers on the Automation HAT board) or a name from "one" to "three" if you prefer.</p>

<p>The <code>payload</code> of the message should be set to:</p>
<ul>
    <li><code>1</code> or <code>on</code> : to turn the output on.</li>
    <li><code>0</code> or <code>off</code> : to turn the output off.</li>
    <li><code>toggle</code> : to toggle the output between each state.</li>
</ul>

<p><b>Relays</b></p>
<p>The three relays on Automation HAT supply both NO (Normally Open) and NC (Normally Closed) terminals. You can use them to switch a single load, or alternate between two. The relays should be placed between the voltage supply and your load. The relays can switch a maxium load of 24V 2A per relay.</p>
<p>Relay outputs are controlled by sending a message with the topic <code>output.&lt;channel&gt;</code> where channel is a number from 1 to 3 (corresponding to the numbers on the Automation HAT board) or a name from "one" to "three" if you prefer.</p>

<p>The <code>payload</code> of the message should be set to:</p>
<ul>
    <li><code>1</code> or <code>on</code> : to switch the relay contacts so that COM is connected to NO.</li>
    <li><code>0</code> or <code>off</code> : to switch the relay contacts so that COM is connected to NC.</li>
    <li><code>toggle</code> : to toggle the relay from its previous state.</li>
</ul>

<p><b>Lights</b></p>
<p>Automation HAT includes three user-controllable lights: Power, Comms and Warn.
<p>Lights are controlled by sending a message with the topic <code>light.&lt;channel&gt;</code> where channel is a the light named on the board "power", "comms", or "warn".</p>

<p>The <code>payload</code> of the message should be set to:</p>
<ul>
    <li><code>1</code> or <code>on</code> or <code>enable</code> : to enable the automatic lights.</li>
    <li><code>0</code> or <code>off</code> or <code>disable</code>: to disable the automatic lights (lights already iluminated will remain lit).</li>
    <li><code>toggle</code> : to toggle the light from its previous state.</li>
</ul>

<p><b>Additional Commands</b></p>
<p>By default the Automation HAT will trigger indicator lights on each input/output automatically.</p>
<p>This behaviour can be controlled by sending a messsage with the topic <code>auto_lights</code></p>

<p>The <code>payload</code> of the message should be set to:</p>
<ul>
    <li><code>1</code> or <code>on</code> : to turn the light on.</li>
    <li><code>0</code> or <code>off</code> : to turn the light off.</li>
</ul>
</script>

